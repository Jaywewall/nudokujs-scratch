<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Modern Sudoku</title>

    <script src="tailwindcss.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="flex flex-col h-full antialiased overflow-hidden">

    <main id="game-container" class="w-full h-full flex flex-col items-center justify-center p-2 sm:p-4 select-none touch-none overflow-hidden">

        <div id="game-elements-wrapper" class="flex flex-col items-center w-full max-w-md">

             <header class="w-full flex justify-between items-center p-2 mb-2 relative flex-shrink-0">
                <div class="flex items-center gap-1">
                     <button id="header-undo-btn" class="p-2 text-[var(--text-muted)] hover:text-[var(--text-primary)] transition rounded-full disabled:opacity-30 disabled:hover:text-[var(--text-muted)]">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 15 3 9m0 0 6-6M3 9h12a6 6 0 0 1 0 12h-3"/></svg>
                    </button>
                    <button id="header-redo-btn" class="p-2 text-[var(--text-muted)] hover:text-[var(--text-primary)] transition rounded-full disabled:opacity-30 disabled:hover:text-[var(--text-muted)]">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 15 6-6m0 0-6-6m6 6H9a6 6 0 0 0 0 12h3"/></svg>
                    </button>
                    <button id="new-game-modal-btn" class="p-2 ml-2 text-[var(--text-muted)] hover:text-[var(--text-primary)] transition rounded-full">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                    </button>
                </div>

                <div class="flex items-center gap-1">
                    <button id="assistance-btn" class="p-2 text-[var(--text-muted)] hover:text-[var(--text-primary)] transition rounded-full">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>
                    </button>
                     <button id="clear-rules-btn" class="p-2 text-red-500 hover:text-red-700 transition rounded-full hidden">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </div>

                <div class="hidden sm:flex items-center gap-1">
                     <button id="reset-btn" class="p-2 text-[var(--text-muted)] hover:text-[var(--text-primary)] transition rounded-full">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
                    </button>
                    <button id="info-btn" class="p-2 text-[var(--text-muted)] hover:text-[var(--text-primary)] transition rounded-full">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                    </button>
                    <button id="settings-btn" class="p-2 text-[var(--text-muted)] hover:text-[var(--text-primary)] transition rounded-full">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33H15a1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                    </button>
                </div>

                <button id="menu-btn" class="flex sm:hidden p-2 text-[var(--text-muted)] hover:text-[var(--text-primary)] transition rounded-full">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
                </button>

                <div id="dropdown-menu" class="hidden absolute top-full right-0 mt-1 w-48 bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 z-50">
                    <div class="py-1" role="menu" aria-orientation="vertical" aria-labelledby="menu-btn">
                         <button id="menu-reset-btn" class="flex items-center w-full px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 hover:text-slate-900" role="menuitem">
                            <svg class="mr-3 h-5 w-5 text-slate-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
                            Reset Board
                        </button>
                        <button id="menu-info-btn" class="flex items-center w-full px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 hover:text-slate-900" role="menuitem">
                            <svg class="mr-3 h-5 w-5 text-slate-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                            How to Play
                        </button>
                        <button id="menu-settings-btn" class="flex items-center w-full px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 hover:text-slate-900" role="menuitem">
                             <svg class="mr-3 h-5 w-5 text-slate-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33H15a1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                            </svg>
                            Settings
                        </button>
                    </div>
                </div>
            </header>

            <div id="grid-wrapper" class="w-full flex justify-center items-center overflow-hidden flex-shrink">
                <div id="sudoku-grid" class="grid grid-cols-9 grid-rows-9 aspect-square w-full max-w-md bg-[var(--bg-secondary)] shadow-lg flex-shrink-0"></div>
            </div>

            <div id="number-picker" class="grid grid-cols-10 gap-1 sm:gap-2 mt-4 w-full max-w-md flex-shrink-0">
                </div>

        </div> </main>

    <div id="modal-backdrop" class="fixed inset-0 bg-black/50 z-40 hidden opacity-0 transition-opacity duration-300"></div>

    <div id="info-modal" class="bg-white fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 p-6 rounded-lg shadow-2xl w-11/12 max-w-lg z-50 hidden opacity-0 scale-95 transition-all duration-300">
        <h2 class="text-xl font-bold mb-4 text-[var(--text-primary)]">How to Play</h2>
        <ul class="space-y-3 list-disc list-inside text-[var(--text-secondary)]">
            <li><strong class="text-[var(--text-primary)]">Enter a Final Number:</strong> Double-tap any empty or user-filled cell to bring up a radial menu.</li>
            <li><strong class="text-[var(--text-primary)]">Select Cells:</strong> Hold and drag on empty cells to select them. Selection is additive.</li>
            <li><strong class="text-[var(--text-primary)]">Inputting Numbers:</strong>
                <ul class="list-disc list-inside ml-4 mt-1">
                    <li><strong class="text-[var(--text-primary)]">One Cell Selected:</strong> Tap a number in the picker to cycle: Candidate → Anti-Candidate → Final Value → Empty.</li>
                    <li><strong class="text-[var(--text-primary)]">Multiple Cells Selected:</strong> Tap a number in the picker to cycle: Candidate → Anti-Candidate → Empty.</li>
                    <li><strong class="text-[var(--text-primary)]">Delete Button:</strong> Erases all user input from selected cells.</li>
                </ul>
            </li>
        </ul>
        <button id="close-info-modal" class="absolute top-3 right-3 p-1 text-[var(--text-muted)] hover:text-[var(--text-primary)] transition rounded-full">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        </button>
    </div>

    <div id="settings-modal" class="bg-white fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 p-6 rounded-lg shadow-2xl w-11/12 max-w-lg z-50 hidden opacity-0 scale-95 transition-all duration-300">
        <h2 class="text-xl font-bold mb-4 text-[var(--text-primary)]">Settings</h2>
        <div class="space-y-4">
             <div class="flex items-center justify-between">
                <label for="blackout-mode-toggle" class="text-sm font-medium text-[var(--text-primary)]">Highlight Blackout Mode</label>
                <input id="blackout-mode-toggle" type="checkbox" class="h-4 w-4 rounded border-[var(--border-strong)] text-blue-600 focus:ring-blue-500">
             </div>
             <p class="text-xs text-[var(--text-muted)]">When enabled and a number is highlighted, blacks out givens/final values of *other* numbers, and anti-candidates of the *highlighted* number.</p>
        </div>
        <button id="close-settings-modal" class="absolute top-3 right-3 p-1 text-[var(--text-muted)] hover:text-[var(--text-primary)] transition rounded-full">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        </button>
    </div>

    <div id="assistance-modal" class="bg-white fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 p-6 rounded-lg shadow-2xl w-11/12 max-w-lg z-50 hidden opacity-0 scale-95 transition-all duration-300">
        <h2 class="text-xl font-bold mb-4 text-[var(--text-primary)]">Assistance Features</h2>
        <div class="space-y-4">
             <div class="flex items-center justify-between">
                <label for="assist-bivalue-toggle" class="text-sm font-medium text-[var(--text-primary)]">Highlight Bi-Value Cells (2 Candidates)</label>
                <input id="assist-bivalue-toggle" type="checkbox" class="h-4 w-4 rounded border-[var(--border-strong)] text-blue-600 focus:ring-blue-500">
             </div>
             <div class="flex items-center justify-between">
                <label for="assist-hidden-singles-toggle" class="text-sm font-medium text-[var(--text-primary)]">Highlight Hidden Singles</label>
                <input id="assist-hidden-singles-toggle" type="checkbox" class="h-4 w-4 rounded border-[var(--border-strong)] text-blue-600 focus:ring-blue-500">
             </div>
             <div class="border-t border-[var(--border-color)] pt-4">
                <button id="solve-singles-btn" class="w-full p-2 rounded-lg bg-blue-600 hover:bg-blue-700 transition text-white font-medium">
                    Solve Single-Candidate Cells
                </button>
             </div>
        </div>
        <button id="close-assistance-modal" class="absolute top-3 right-3 p-1 text-[var(--text-muted)] hover:text-[var(--text-primary)] transition rounded-full">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        </button>
    </div>

    <div id="reset-modal" class="bg-white fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 p-6 rounded-lg shadow-2xl w-11/12 max-w-sm z-50 hidden opacity-0 scale-95 transition-all duration-300">
        <h2 class="text-xl font-bold mb-2 text-center text-[var(--text-primary)]">Reset Board?</h2>
        <p class="text-center text-[var(--text-secondary)] mb-6">All your progress will be lost.</p>
        <div class="flex justify-around items-center gap-4">
            <button id="cancel-reset-btn" class="w-full p-2 rounded-lg bg-slate-200 hover:bg-slate-300 transition text-slate-700">Cancel</button>
            <button id="confirm-reset-btn" class="w-full p-2 rounded-lg bg-red-600 hover:bg-red-700 transition text-white">Reset</button>
        </div>
    </div>

    <div id="new-game-select-modal" class="bg-white fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 p-6 rounded-lg shadow-2xl w-11/12 max-w-md z-50 hidden opacity-0 scale-95 transition-all duration-300 flex flex-col" style="max-height: 80vh;">
        <h2 class="text-xl font-bold mb-4 text-[var(--text-primary)] flex-shrink-0">Select Puzzle</h2>
        <div class="mb-4 flex-shrink-0">
            <label for="difficulty-select" class="block text-sm font-medium text-[var(--text-secondary)] mb-1">Difficulty</label>
            <select id="difficulty-select" class="w-full p-2 border border-[var(--border-color)] rounded-md bg-[var(--bg-primary)] text-[var(--text-primary)] focus:ring-blue-500 focus:border-blue-500">
                <option value="Easy">Easy</option>
                <option value="Medium">Medium</option>
                <option value="Hard">Hard</option>
                <option value="Expert">Expert</option>
            </select>
        </div>
        <div id="puzzle-list-container" class="flex-grow overflow-y-auto border border-[var(--border-color)] rounded-md p-2 bg-slate-50 space-y-1">
            <p class="text-sm text-center text-[var(--text-muted)]">Loading puzzles...</p>
        </div>
        <div class="mt-6 flex justify-end flex-shrink-0">
            <button id="cancel-select-new-game-btn" class="py-2 px-4 rounded-lg bg-slate-200 hover:bg-slate-300 transition text-slate-700">Cancel</button>
            </div>
    </div>
    <div id="input-pill" class="modal-glass fixed z-50 rounded-full p-1 flex flex-col items-center gap-1 hidden opacity-0 scale-90">
        <button class="pill-item w-12 h-12 flex items-center justify-center rounded-full hover:bg-slate-500/50" data-type="selection-mode">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-400"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><path d="m9 12 2 2 4-4"></path></svg>
        </button>
        <button class="pill-item w-12 h-12 flex items-center justify-center rounded-full hover:bg-slate-500/50" data-type="anti-candidate"></button>
        <button class="pill-item w-12 h-12 flex items-center justify-center rounded-full hover:bg-slate-500/50" data-type="candidate"></button>
        <button class="pill-item w-12 h-12 flex items-center justify-center rounded-full hover:bg-slate-500/50" data-type="value"></button>
    </div>

    <div id="undo-redo-popover" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex gap-4 bg-slate-800/80 backdrop-blur-sm p-4 rounded-lg shadow-2xl z-50 hidden opacity-0 scale-90 transition-all duration-200">
        <button id="popover-undo-btn" class="p-3 text-[var(--text-secondary)] hover:text-[var(--text-primary)] disabled:text-slate-600 transition rounded-full bg-slate-700/50 hover:bg-slate-700 disabled:hover:bg-slate-700/50">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 15 3 9m0 0 6-6M3 9h12a6 6 0 0 1 0 12h-3"/></svg>
        </button>
        <button id="popover-redo-btn" class="p-3 text-[var(--text-secondary)] hover:text-[var(--text-primary)] disabled:text-slate-600 transition rounded-full bg-slate-700/50 hover:bg-slate-700 disabled:hover:bg-slate-700/50">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 15 6-6m0 0-6-6m6 6H9a6 6 0 0 0 0 12h3"/></svg>
        </button>
    </div>

    <div id="radial-menu" style="width:200px; height:200px;" class="fixed pointer-events-none z-50 rounded-full hidden opacity-0 scale-75"></div>


    <script src="app.state.js"></script>
    <script src="app.puzzles.js"></script>
    <script src="app.render.js"></script>
    <script src="app.ui.js"></script>
    <script src="app.interactions.js"></script>
    <script src="app.board.js"></script>
    <script src="app.main.js"></script>
</body>
</html>